/*
Пробный вариант к зачету по дисциплине МДК.01.04 Системное программирование
Вариант №6
В базе данных хранятся сведения о работе библиотеки:
дата текущего года, фамилия читателя, количество книг
Структура входного файла in.txt
23.10.2022 Винни-Пух 5
12.11.2022 Пятачок 3
15.10.2022 Винни-Пух 7
...
Определить количество книг, взятых за каждый месяц, упорядочив по номеру месяца
Структура выходного файла out.txt
Месяц года Количество
10.2022 12
11.2022 3
*Дополнительно реализовано:
1. Меню
2. Запись в разные текстовые файлы для разных сортировок
3. Добавление, удаление, редактирование в массив
Выполнил Базан Игорь 303ИС-22

Файл main.c является точкой входа в программу.
Он читает данные из файла in.txt, создает массив записей и предоставляет меню.
Меню позволяет сортировать записи, добавлять, удалять и редактировать их, а также выводить список на экран.
После выполнения операций сортировки результаты сохраняются в соответствующие файлы
(sorted_by_month.txt, sorted_by_surname.txt, sorted_by_books.txt, out.txt для сводки по месяцам).

Тестирование программы:
Для проверки корректности работы программы используются следующие шаги тестирования:
1. Подготовка входного файла:
- Создать файл in.txt с содержимым:
23.10.2022 Vinni-Pukh 5
12.11.2022 Pyatachok 3
15.10.2022 Vinni-Pukh 7
14.10.2022 Chebyrashka 10
2. Проверка чтения данных:
- Запустить программу, выбрать пункт меню 7 (вывод списка).
- Ожидаемый вывод:
23.10.2022 Vinni-Pukh 5
12.11.2022 Pyatachok 3
15.10.2022 Vinni-Pukh 7
14.10.2022 Chebyrashka 10
3. Проверка сортировки по месяцу (пункт меню 1):
- Выбрать пункт 1, проверить содержимое файла sorted_by_month.txt:
23.10.2022 Vinni-Pukh 5
15.10.2022 Vinni-Pukh 7
14.10.2022 Chebyrashka 10
12.11.2022 Pyatachok 3
- Проверить файл out.txt (месячная сводка):
Месяц года Количество
10.2022 22
11.2022 3
4. Проверка сортировки по фамилии (пункт меню 2):
- Выбрать пункт 2, проверить содержимое файла sorted_by_surname.txt:
14.10.2022 Chebyrashka 10
12.11.2022 Pyatachok 3
23.10.2022 Vinni-Pukh 5
15.10.2022 Vinni-Pukh 7
5. Проверка сортировки по количеству книг (пункт меню 3):
- Выбрать пункт 3, проверить содержимое файла sorted_by_books.txt:
12.11.2022 Pyatachok 3
23.10.2022 Vinni-Pukh 5
15.10.2022 Vinni-Pukh 7
14.10.2022 Chebyrashka 10
6. Проверка добавления записи (пункт меню 4):
- Выбрать пункт 4, ввести данные: 01.12.2022 Kanga 4
- Выбрать пункт 7, проверить, что новая запись появилась:
12.11.2022 Pyatachok 3
23.10.2022 Vinni-Pukh 5
15.10.2022 Vinni-Pukh 7
14.10.2022 Chebyrashka 10
1.12.2022 Kanga 4
7. Проверка удаления записи (пункт меню 5):
- Выбрать пункт 5, ввести фамилию: Pyatachok
- Проверить с помощью пункта 7, что запись удалена,
а последняя запись (Kanga) перемещена на место Pyatachok:
1.12.2022 Kanga 4
23.10.2022 Vinni-Pukh 5
15.10.2022 Vinni-Pukh 7
14.10.2022 Chebyrashka 10
8. Проверка редактирования записи (пункт меню 6):
- Выбрать пункт 6, ввести фамилию: Vinni-Pukh
- Ввести новые данные: 10.10.2022 Vinni-Pukh 8
- Проверить с помощью пункта 7, что запись обновлена
(первая запись с Vinni-Pukh изменена).
1.12.2022 Kanga 4
10.10.2022 Vinni-Pukh 8
15.10.2022 Vinni-Pukh 7
14.10.2022 Chebyrashka 10
9. Проверка выхода (пункт меню 0):
- Выбрать пункт 0, убедиться, что программа завершает работу с сообщением "Выход..."
*Примечания:
- Если запись с указанной фамилией не найдена
(например, при удалении или редактировании),
программа должна вывести сообщение об ошибке.
- Если массив переполнен при добавлении (более 100 записей),
программа должна сообщить "Массив переполнен!".
- Для проверки файлов рекомендуется использовать текстовый редактор
или команду cat (в Linux) или type (в Windows).
*/

#include <stdio.h>
#include <locale.h>
#include "library.h"

/*
Основная функция программы.
Читает данные из файла in.txt, предоставляет меню для управления записями
и выполняет выбранные пользователем действия.
*/
int main() {
	setlocale(LC_ALL, "Russian");
	FILE *f_in = fopen("in.txt", "r");
	if (f_in == NULL) {
		printf("Ошибка открытия файла in.txt!\n");
		return 1;
	}
	record ar[AR_SIZE];
	int count = 0;
	while (fscanf(f_in, "%d.%d.%d %s %d",
		&ar[count].issue_date.day,
		&ar[count].issue_date.month,
		&ar[count].issue_date.year,
		ar[count].surname,
		&ar[count].books) == 5) {
		++count;
	}
	fclose(f_in);
	int choice;
	do {
		print_menu();
		scanf("%d", &choice);
		switch (choice) {
		case 1:
			//Сортировка по месяцу, сохранение результатов и вывод списка.
			sort_by_month(ar, count);
			save_to_file(ar, count, "sorted_by_month.txt");
			save_monthly_summary(ar, count, "out.txt");
			printf("Отсортировано по месяцу и сохранено в sorted_by_month.txt\n");
			printf("Итоги по месяцам сохранены в out.txt\n");
			ar_print(ar, count);
			break;
		case 2:
			//Сортировка по фамилии, сохранение результатов и вывод списка.
			sort_by_surname(ar, count);
			save_to_file(ar, count, "sorted_by_surname.txt");
			printf("Отсортировано по фамилии и сохранено в sorted_by_surname.txt\n");
			ar_print(ar, count);
			break;
		case 3:
			//Сортировка по количеству книг, сохранение результатов и вывод списка.
			sort_by_books(ar, count);
			save_to_file(ar, count, "sorted_by_books.txt");
			printf("Отсортировано по количеству книг и сохранено в sorted_by_books.txt\n");
			ar_print(ar, count);
			break;
		case 4:
			//Добавление новой записи и вывод обновленного списка.
			add_record(ar, &count);
			ar_print(ar, count);
			break;
		case 5:
			//Удаление записи по фамилии и вывод обновленного списка.
			delete_record(ar, &count);
			ar_print(ar, count);
			break;
		case 6:
			//Редактирование записи по фамилии и вывод обновленного списка.
			edit_record(ar, count);
			ar_print(ar, count);
			break;
		case 7:
			//Вывод текущего списка записей.
			ar_print(ar, count);
			break;
		case 0:
			//Выход из программы.
			printf("Выход...\n");
			break;
		default:
			printf("Неверный выбор!\n");
		}
	} while (choice != 0);
	return 0;
}
